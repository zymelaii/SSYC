# 代码规范

## 命名规范

|          Item           |          Convention          |
| :---------------------: | :--------------------------: |
|        Function         |          snake_case          |
|        Parameter        |        lowerCamelCase        |
|         Method          |          snake_case          |
| Public member variable  |        lowerCamelCase        |
| Private member variable |       lowerCamelCase_        |
|         Static          |     SCREAMING_SNAKE_CASE     |
|        Constant         |     SCREAMING_SNAKE_CASE     |
|          Enum           |        UpperCamelCase        |
|       Type trait        |          snake_case          |
|   General Custom Type   |        UpperCamelCase        |
|   Builtin type alias    |          snake_case          |
|       Member type       | snake_case or UpperCamelCase |
|    Member type alias    | snake_case or UpperCamelCase |

## 文件与命名空间规范

1. 使用 `.cpp` 作为源文件的后缀
2. 使用 `.h` 作为头文件的后缀
3. 文件名全部使用 `UpperCamelCase`
4. 目录名使用 `sneak_case`，除非其具备明确语义
5. 命名空间应尽可能与目录结构保持一致
6. 命名空间使用 `sneak_case`，除非其具备明确语义
7. 分离头文件与源码的根目录
8. 头文件的引用至多包含相对引用与绝对引用两个部分，各个部分内部不换行，两个部分之间以一个换行分隔
9. 头文件的开头必须使用 `#pragma once` 声明

## 头文件包含规范

1. 必须明确包含目标所在的头文件，当头文件来自外部时，禁止隐式地间接包含
2. 可选时，必须使用 `C++` 风格的标准库头文件替代 `C` 风格的头文件
3. 禁止包含未被使用的头文件
4. 若包含头文件仅用于导出符号或类似用途，使用 `IWYU pragma` 进行标记

## 编码规范

1. `if`/`else`/`while`/`do`/`case` 等引导的语句必须使用 `{}` 包含
2. `case`/`default` 必须使用 `keyword: { ... } break;` 的格式，无论 `break` 是否是可达的
3. 优先使用前置 `++`/`--` 而不是后置算符
4. 处理固定映射时，优先考虑内存中打表索引，其次再考虑 `switch` 等方案
5. 禁止在类内实现函数定义，即使其是一个模板
6. 内联函数必须在声明的同文件内实现
7. 头文件中非内联函数的实现必须在同名的源文件中
8. 尽可能使用前置声明而不是包含对应的头文件
9. 使用模板时尽可能进行模板参约束
10. 禁止在枚举类中令多个枚举项拥有同一值
11. 若控制流的非终止点不可达，必须显式标记为 `unreachable`
12. 尽可能多地使用 `assert` 断言，并尽可能使断言的条件独立
13. 访问标准库对象时，必须明确指定命名空间 `std` 或命名空间的别名
14. 除非需要将符号暴露给当前命名空间并导出，禁止在头文件中 using 命名空间
15. 禁止出现菱形继承
16. 优先考虑组合+方法转发替代继承
17. 纯数据类型应使用 `struct` 声明并禁用 `public`/`protected`/`private`，确保任意成员的访问权限为默认公开
18. 避免使用友元，若必要，尽可能减小友元的范畴
19. 尽可能规避不必要的模板蔓延
20. 尽可能避免虚继承与非虚继承的混用
21. 优先考虑代码的易读性、易用性，其次考虑优化
22. 禁止使用孤立且不常见的常数
23. 当某一常数被多次使用时，必须重新声明并明确其含义
24. 禁止将整型强转为 `enum class`，并尽可能避免将 `enum class` 转换为整型
25. 优先考虑 `enum class` 或结构体+静态常量的组合，而不是 `enum`
26. 构造函数的初始化列表中使用 `{}` 表示值初始化，使用 `()` 表示构造方法初始化
27. 构造函数中，必须在初始化列表显式地初始化所有成员变量，即使其是默认构造或会被二次赋值
28. 禁止混用构造函数初始化与声明时初始化
29. 统一使用后置函数返回类型声明

## 协作规范

1. 协作部分开发时优先考虑自顶向下，私有环节开发时依具体情况而定
2. 上游开发时优先考虑向需求方暴露接口
3. 上游重构时尽可能避免接口处的大幅度改动
4. 在符合情景的地方使用 `TODO` 与 `FIXME` 注释，并尽可能指出函数的异常行为
5. 提交代码时必须使用统一的配置文件进行代码格式化
6. 对于单个开发任务，避免过高的复杂度与过长的开发周期
7. 当目标功能相对独立且具有一定复杂度时，进入新的分支进行开发
